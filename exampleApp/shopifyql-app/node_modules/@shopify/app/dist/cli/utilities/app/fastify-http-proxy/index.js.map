{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/cli/utilities/app/fastify-http-proxy/index.js"],"names":[],"mappings":"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","sourcesContent":["import From from '@fastify/reply-from'\nimport WebSocket, {WebSocketServer} from 'ws'\n\nconst httpMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT', 'OPTIONS']\nconst urlPattern = /^https?:\\/\\//\n\nfunction liftErrorCode(code) {\n  if (typeof code !== 'number') {\n    // Sometimes \"close\" event emits with a non-numeric value\n    return 1011\n  } else if (code === 1004 || code === 1005 || code === 1006) {\n    // ws module forbid those error codes usage, lift to \"application level\" (4xxx)\n    return 4000 + (code % 1000)\n  } else {\n    return code\n  }\n}\n\nfunction closeWebSocket(socket, code, reason) {\n  if (socket.readyState === WebSocket.OPEN) {\n    socket.close(liftErrorCode(code), reason)\n  }\n}\n\nfunction waitConnection(socket, write) {\n  if (socket.readyState === WebSocket.CONNECTING) {\n    socket.once('open', write)\n  } else {\n    write()\n  }\n}\n\nfunction isExternalUrl(url = '') {\n  return urlPattern.test(url)\n}\n\nfunction proxyWebSockets(source, target) {\n  function close(code, reason) {\n    closeWebSocket(source, code, reason)\n    closeWebSocket(target, code, reason)\n  }\n\n  source.on('message', (data) => waitConnection(target, () => target.send(data, {binary: false})))\n  source.on('ping', (data) => waitConnection(target, () => target.ping(data)))\n  source.on('pong', (data) => waitConnection(target, () => target.pong(data)))\n  source.on('close', close)\n  source.on('error', (error) => close(1011, error.message))\n  source.on('unexpected-response', () => close(1011, 'unexpected response'))\n\n  // source WebSocket is already connected because it is created by ws server\n  target.on('message', (data) => source.send(data, {binary: false}))\n  target.on('ping', (data) => source.ping(data))\n  target.on('pong', (data) => source.pong(data))\n  target.on('close', close)\n  target.on('error', (error) => close(1011, error.message))\n  target.on('unexpected-response', () => close(1011, 'unexpected response'))\n}\n\nfunction convertUrlToWebSocket(urlString) {\n  return urlString.replace(/^(http)(s)?:\\/\\//, 'ws$2://')\n}\n\nfunction setupWebSocketProxy(fastify, options, rewritePrefix) {\n  const server = new WebSocketServer({\n    server: fastify.server,\n    ...options.wsServerOptions,\n  })\n\n  fastify.addHook('onClose', (instance, done) => server.close(done))\n\n  // To be able to close the HTTP server,\n  // all WebSocket clients need to be disconnected.\n  // Fastify is missing a pre-close event, or the ability to\n  // add a hook before the server.close call. We need to resort\n  // to monkeypatching for now.\n  const oldClose = fastify.server.close\n  fastify.server.close = function (done) {\n    for (const client of server.clients) {\n      client.close()\n    }\n    oldClose.call(this, done)\n  }\n\n  server.on('error', (err) => {\n    fastify.log.error(err)\n  })\n\n  server.on('connection', (source, request) => {\n    // Send a ping to the client every 10s to make sure the connection stays alive\n    // If the conneciton is closed, the interval is cancelled\n    const timer = setInterval(() => {\n      source.readyState >= 2 ? clearInterval(timer) : source.ping()\n    }, 10000)\n\n    if (fastify.prefix && !request.url.startsWith(fastify.prefix)) {\n      fastify.log.debug({url: request.url}, 'not matching prefix')\n      clearInterval(timer)\n      source.close()\n      return\n    }\n\n    let optionsWs = {}\n    if (request.headers.cookie) {\n      const headers = {cookie: request.headers.cookie}\n      optionsWs = {...options.wsClientOptions, headers}\n    } else {\n      optionsWs = options.wsClientOptions\n    }\n\n    const url = createWebSocketUrl(request)\n\n    const target = new WebSocket(url, optionsWs)\n\n    fastify.log.debug({url: url.href}, 'proxy websocket')\n    proxyWebSockets(source, target)\n  })\n\n  function createWebSocketUrl(request) {\n    const source = new URL(request.url, 'ws://127.0.0.1')\n\n    const target = new URL(\n      source.pathname.replace(fastify.prefix, rewritePrefix),\n      convertUrlToWebSocket(options.upstream),\n    )\n\n    target.search = source.search\n\n    return target\n  }\n}\n\nfunction generateRewritePrefix(prefix, opts) {\n  if (!prefix) {\n    return ''\n  }\n\n  let rewritePrefix = opts.rewritePrefix || (opts.upstream ? new URL(opts.upstream).pathname : '/')\n\n  if (!prefix.endsWith('/') && rewritePrefix.endsWith('/')) {\n    rewritePrefix = rewritePrefix.slice(0, -1)\n  }\n\n  return rewritePrefix\n}\n\nasync function httpProxy(fastify, opts) {\n  if (\n    !opts.upstream &&\n    !(opts.upstream === '' && opts.replyOptions && typeof opts.replyOptions.getUpstream === 'function')\n  ) {\n    throw new Error('upstream must be specified')\n  }\n\n  const preHandler = opts.preHandler || opts.beforeHandler\n  const rewritePrefix = generateRewritePrefix(fastify.prefix, opts)\n\n  const fromOpts = {...opts}\n  fromOpts.base = opts.upstream\n  fromOpts.prefix = undefined\n\n  const oldRewriteHeaders = (opts.replyOptions || {}).rewriteHeaders\n  const replyOpts = {...opts.replyOptions, rewriteHeaders}\n  fromOpts.rewriteHeaders = rewriteHeaders\n\n  fastify.register(From, fromOpts)\n\n  if (opts.proxyPayloads !== false) {\n    fastify.addContentTypeParser('application/json', bodyParser)\n    fastify.addContentTypeParser('*', bodyParser)\n  }\n\n  function rewriteHeaders(headers) {\n    const location = headers.location\n    if (location && !isExternalUrl(location)) {\n      headers.location = location.replace(rewritePrefix, fastify.prefix)\n    }\n    if (oldRewriteHeaders) {\n      headers = oldRewriteHeaders(headers)\n    }\n    return headers\n  }\n\n  function bodyParser(req, payload, done) {\n    done(null, payload)\n  }\n\n  fastify.route({\n    url: '/',\n    method: opts.httpMethods || httpMethods,\n    preHandler,\n    config: opts.config || {},\n    constraints: opts.constraints || {},\n    handler,\n  })\n  fastify.route({\n    url: '/*',\n    method: opts.httpMethods || httpMethods,\n    preHandler,\n    config: opts.config || {},\n    constraints: opts.constraints || {},\n    handler,\n  })\n\n  function handler(request, reply) {\n    const queryParamIndex = request.raw.url.indexOf('?')\n    let dest = request.raw.url.slice(0, queryParamIndex !== -1 ? queryParamIndex : undefined)\n    dest = dest.replace(this.prefix, rewritePrefix)\n    reply.from(dest || '/', replyOpts)\n  }\n\n  if (opts.websocket) {\n    setupWebSocketProxy(fastify, opts, rewritePrefix)\n  }\n}\n\nhttpProxy[Symbol.for('plugin-meta')] = {\n  fastify: '4.x',\n  name: '@fastify/http-proxy',\n}\n\nexport default httpProxy\nexport const fastifyHttpProxy = httpProxy\n"]}